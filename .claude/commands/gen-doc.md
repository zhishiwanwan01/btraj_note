---
description: 为选中的函数或变量生成标准格式文档，自动保存到 code docs 目录
allowed-tools: Read,Write,Glob,Grep
---

为用户选中的函数或变量生成标准格式的文档。

## 工作流程

1. **获取选中代码**：从用户选中的代码片段中提取函数名或变量名
2. **识别代码类型**：自动判断是函数还是变量
3. **定位源文件**：从当前打开的文件获取完整路径
4. **生成文档**：根据类型使用相应的文档模板
5. **自动保存**：保存到 `docs/code docs/文件名/` 目录下

## 存放规则

**源文件路径** → **文档目录映射**：
- 源文件：`{bash} catkin_ws/src/Btraj/src/XXX.cpp`
- 文档目录：`{bash} docs/code docs/XXX.cpp/`
- 文档文件：`{bash} docs/code docs/XXX.cpp/名称.md`

**示例**：
```
源文件：catkin_ws/src/Btraj/src/trajectory_generator.cpp
函数：BezierPloyCoeffGeneration
→ 文档：docs/code docs/trajectory_generator.cpp/BezierPloyCoeffGeneration.md

源文件：catkin_ws/src/Btraj/src/trajectory_generator.cpp
变量：con_bdk
→ 文档：docs/code docs/trajectory_generator.cpp/con_bdk变量说明.md
```

## 文档格式标准

### 函数文档模板

参考现有文档（如 `{bash} docs/code docs/b_traj_node.cpp/rcvOdometryCallbck.md`）：

```markdown
---
tags:
aliases:
date created: [当前日期时间，格式：Day, Month DDth YYYY, H:MM:SS pm]
date modified: [同上]
---
# 函数名 - 简短中文描述

**位置**：`{bash} 源文件路径:行号`
**函数签名**：`{cpp} 完整函数签名`

## What（功能）
函数的功能描述，使用编号列表：
1. **第一个功能**：详细说明
2. **第二个功能**：详细说明

## Why（目的）
为什么需要这个函数：
1. **目的1**：说明
2. **目的2**：说明

## 输入参数详解

### 参数名1 - 参数简短描述
| 属性     | 值           |
| -------- | ------------ |
| **类型** | `{cpp} 类型` |
| **来源** | 变量来源     |
| **含义** | 参数的含义   |

**矩阵结构**（如果是矩阵）：
```
详细的矩阵结构说明
```

**在函数中的使用**（第XX行）：
```cpp
代码示例
```

### 参数名2 - 参数简短描述
[同上格式]

## 输出参数详解

### 输出参数名 - 描述
| 属性     | 值             |
| -------- | -------------- |
| **类型** | `{cpp} 类型&`  |
| **含义** | 输出参数的含义 |

## 关键变量说明
（如果适用）

## 相关函数
- `{cpp} 函数名()`: 功能说明 - [[wiki-link]]
```

### 变量文档模板

参考 `{bash} docs/code docs/trajectory_generator.cpp/con_bdk.md`：

```markdown
---
tags:
aliases:
date created: [当前日期时间，格式：Day, Month DDth YYYY, H:MM:SS pm]
date modified: [同上]
---
# 变量名 - 简短中文描述

## 1. 基本信息

| 属性         | 值                           |
| ------------ | ---------------------------- |
| **声明位置** | `{bash} 文件名.cpp:行号`     |
| **所属函数** | `{cpp} 函数名()`             |
| **数据类型** | `{cpp} 完整类型`             |
| **作用域**   | 函数局部变量/全局变量/类成员 |
| **生命周期** | 变量的生命周期说明           |

**完整声明**：
```cpp
完整的变量声明
```

## 2. 变量概述

变量的核心作用和在系统中的角色

**核心职责**：
1. **职责1**：说明
2. **职责2**：说明

**在系统中的角色**：
```
简单的流程图或说明
```

## 3. 数据结构解析

### 3.1 类型层次结构

```cpp
// 如果是复杂类型，展示层次结构
类型的详细拆解
```

### 3.2 类型组成部分详解

详细解释类型的每个组成部分

#### 组成部分1
说明

#### 组成部分2
说明

### 3.3 单个元素示例

```cpp
具体的元素示例
```

## 4. 数据来源与初始化

### 4.1 初始化流程概览

```
流程图或步骤说明
```

### 4.2 阶段详解

**阶段1**：说明
**阶段2**：说明

## 5. 数据流向与使用

### 5.1 数据流动路径

```
数据流向图
```

### 5.2 在代码中的使用

详细说明变量如何被使用

## 6. 完整数据示例

### 6.1 场景参数
具体场景的参数设置

### 6.2 实际数据
变量在该场景下的实际数据内容

## 7. 相关变量与依赖

### 7.1 直接依赖的输入参数

| 变量名 | 类型 | 来源 | 用途 |
| ------ | ---- | ---- | ---- |

### 7.2 计算依赖的局部变量

| 变量名 | 类型 | 计算方式 | 含义 |
| ------ | ---- | -------- | ---- |

### 7.3 配对使用的变量

| 变量名 | 关系 | 说明 |
| ------ | ---- | ---- |

### 7.4 数据流依赖图

```
依赖关系图
```

## 8. 调试与验证

### 8.1 基本检查代码

```cpp
基本的检查代码
```

### 8.2 详细打印函数

```cpp
详细的调试打印函数
```

### 8.3 常见问题排查

#### 问题1：问题描述
排查方法

#### 问题2：问题描述
排查方法

---

## 相关文档链接
- [[相关文档1]]
- [[相关文档2]]
```

## 代码格式规范

### 行内代码引用格式
- C++代码：`{cpp} code`
- Python代码：`{python} code`
- Bash命令：`{bash} command`
- 路径：`{bash} path/to/file`
- 其他语言：`{语言名} code`

### 代码块格式
````markdown
```cpp
// C++ 代码块
int main() {
    return 0;
}
```

```python
# Python 代码块
def hello():
    print("Hello")
```

```bash
# Bash 命令块
ls -la
```
````

## 任务执行步骤

### 步骤1：解析选中代码
1. 从用户选中的代码中提取函数名或变量名
2. 获取当前文件路径（从系统上下文中获取）
3. 判断是函数还是变量：
   - 如果包含 `{cpp} ()` 或返回类型+函数名，则为函数
   - 如果是类型+变量名的声明，则为变量

### 步骤2：定位并分析源代码
1. 读取源文件完整内容
2. 找到选中的函数或变量的定义
3. 记录行号
4. 提取完整的函数签名或变量声明
5. 如果是函数，分析：
   - 返回类型
   - 参数列表
   - 函数体的关键逻辑
6. 如果是变量，分析：
   - 数据类型（特别是复杂类型的结构）
   - 初始化方式
   - 使用位置

### 步骤3：确定输出路径
1. 从源文件路径提取文件名（如 `{bash} trajectory_generator.cpp`）
2. 构建文档目录：`{bash} docs/code docs/文件名/`
3. 根据类型确定文档文件名：
   - 函数：`{bash} docs/code docs/文件名/函数名.md`
   - 变量：`{bash} docs/code docs/文件名/变量名.md`

### 步骤4：生成文档内容
1. **如果是函数**：
   - 使用函数文档模板
   - 详细分析每个参数：类型、来源、含义
   - 分析函数的功能和目的
   - 包含代码示例
   - 列出相关函数

2. **如果是变量**：
   - 使用变量文档模板（8个章节）
   - 第1节：基本信息表格
   - 第2节：变量概述和角色
   - 第3节：数据结构详细拆解（如果是复杂类型）
   - 第4节：数据来源和初始化过程
   - 第5节：数据流向和使用方式
   - 第6节：完整的数据示例
   - 第7节：相关变量和依赖关系
   - 第8节：调试代码和常见问题排查

3. **通用要求**：
   - 所有行内代码使用 `{cpp} code` 格式
   - 所有路径使用 `{bash} path` 格式
   - 日期格式：Day, Month DDth YYYY, H:MM:SS pm
   - 中文描述详细清晰
   - 包含实际的代码示例

### 步骤5：保存文件
1. 检查目录是否存在，不存在则创建
2. 保存到正确位置
3. 告知用户文档已生成及其路径

## 使用说明

### 调用方式
```bash
# 1. 在编辑器中选中要生成文档的代码
#    - 可以选中整个函数定义
#    - 也可以只选中函数名或变量声明那一行

# 2. 执行命令（无需参数）
/gen-doc
```

### 示例场景

#### 场景1：为函数生成文档
```cpp
// 用户在 trajectory_generator.cpp 中选中以下代码：
void BezierPloyCoeffGeneration(
    const MatrixXd &Path,
    const Eigen::MatrixXd &MQM,
    ...
) {
    ...
}

// 执行 /gen-doc
// 生成：docs/code docs/trajectory_generator.cpp/BezierPloyCoeffGeneration.md
```

#### 场景2：为变量生成文档
```cpp
// 用户在 trajectory_generator.cpp 中选中以下代码：
vector<pair<MSKboundkeye, pair<double, double>>> con_bdk;

// 执行 /gen-doc
// 生成：docs/code docs/trajectory_generator.cpp/con_bdk.md
```

## 注意事项

1. **自动检测**：命令会自动检测当前文件路径和选中代码类型
2. **覆盖警告**：如果文档已存在，会提示是否覆盖
3. **深度分析**：对于复杂的函数和变量，需要深入分析源码上下文
4. **代码格式**：严格遵守 `{cpp}` 和 `{bash}` 的格式规范
5. **中文描述**：使用清晰的中文描述，专业术语保留英文
